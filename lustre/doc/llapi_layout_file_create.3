.TH llapi_layout_file_open 3 "2013 Oct 31" "Lustre User API"
.SH NAME
llapi_layout_file_open, llapi_layout_file_create \- open and apply a layout to a Lustre file
.SH SYNOPSIS
.nf
.B #include <lustre/lustreapi.h>
.PP
.BI "int llapi_layout_file_open(const llapi_layout_t *" layout ",
.BI "                           char *" path ", int " flags ", int " mode );
.PP
.BI "int llapi_layout_file_create(const llapi_layout_t *" layout ",
.BI "                             char *" path ", int " flags ", int " mode );
.fi
.SH DESCRIPTION
.LP
The functions
.B llapi_layout_file_open()
and
.B llapi_layout_file_create()
open and possibly create a file at
.I path
with the permissions specified in
.I mode
using the Lustre layout attributes in
.IR layout .
Zero or more file creation flags and file status flags can
be bitwise-or'd in
.IR flags .
See
.BR open (2).
It is an error if
.I path
is not on a Lustre filesystem.
.PP
The function call
.PP
.B "    llapi_layout_file_create(layout, path, flags, mode)"
.PP
shall be equivalent to:
.PP
.B "    llapi_layout_file_open(layout, path, flags|O_CREAT|O_EXCL, mode)"
.PP
The
.I layout
and
.I mode
will not be applied to a file which already exists. Callers requiring a
guarantee that the opened file is created with the specified
.I layout
and
.I mode
should use
.BR llapi_layout_file_create() .
.PP
A
.B NULL
.I layout
may be specified, in which case the standard Lustre behavior for
assigning layouts to newly-created files will apply.
.PP
If the pool name attribute of
.I layout
has been set, it must refer to an OST pool that exists and contains one
or more OSTs, otherwise these functions will fail and set
.B errno
to
.BR EINVAL .
See
.BR llapi_layout_pool_name_set (3).
.SH RETURN VALUES
.LP
.B llapi_layout_file_open()
and
.B llapi_layout_file_create()
return a new file descriptor, or -1 if an error occurred (in which
case, errno is set appropriately).
.SH ERRORS
.TP 15
.SM ENOTTY
.I path
does not reside on a Lustre filesystem.
.TP
.SM EINVAL
An invalid argument was specified.
.SH "SEE ALSO"
.BR llapi_layout (7),
.BR liblustreapi (7),
.BR llapi_layout_alloc (3),
.BR llapi_layout_pool_name_set (3),
.BR open (2)
