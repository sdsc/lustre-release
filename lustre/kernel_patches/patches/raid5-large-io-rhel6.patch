Index: linux-2.6.32-279.14.1.el6.x86_64/drivers/md/raid5.c
===================================================================
--- linux-2.6.32-279.14.1.el6.x86_64.orig/drivers/md/raid5.c
+++ linux-2.6.32-279.14.1.el6.x86_64/drivers/md/raid5.c
@@ -5115,6 +5115,12 @@ static int run(struct mddev *mddev)
 		blk_queue_io_min(mddev->queue, chunk_size);
 		blk_queue_io_opt(mddev->queue, chunk_size *
 				 (conf->raid_disks - conf->max_degraded));
+		{
+		int stripe_size = conf->chunk_sectors * (conf->previous_raid_disks - conf->max_degraded);
+
+		blk_queue_max_hw_sectors(mddev->queue, stripe_size >> 9);
+		blk_queue_max_segments(mddev->queue, stripe_size >> PAGE_SHIFT);
+		}
 
 		list_for_each_entry(rdev, &mddev->disks, same_set)
 			disk_stack_limits(mddev->gendisk, rdev->bdev,
