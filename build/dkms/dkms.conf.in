# Lustre kernel modules dkms configuration file
# modified by B.Faccini for RPM packaging

# Due to the way DKMS is copying files to the build area without
# preserving time-stamps (DKMS bug 952817), and thus to avoid the need
# to ship autogen.sh along with auto-tools to be installed, we use the
# --disable-maintainer-mode switch.
MAKE="./configure --disable-maintainer-mode --disable-utils "\
"--disable-liblustre --disable-snmp --disable-doc "\
"--disable-tests --disable-liblustre-tests --disable-gss "\
@SERVER_FALSE@"--disable-server "\
"--without-lustre-iokit --with-linux=$kernel_source_dir && make"
CLEAN="make distclean"

AUTOINSTALL=yes
@SERVER_TRUE@PACKAGE_NAME=lustre-modules
@SERVER_FALSE@PACKAGE_NAME=lustre-client-modules
PACKAGE_VERSION=@AC_LUSTRE_VERSION_STRING@

#Restrict builds to the patchess support matrix.
BUILD_EXCLUSIVE_KERNEL="^2.6.(1[8-9]|2[0-9]|3[0-2])"
STRIP="no"

# Module names
BUILT_MODULE_NAME[0]="fid"
BUILT_MODULE_NAME[1]="fld"
BUILT_MODULE_NAME[2]="lmv"
BUILT_MODULE_NAME[3]="lov"
BUILT_MODULE_NAME[4]="lustre"
BUILT_MODULE_NAME[5]="mdc"
BUILT_MODULE_NAME[6]="mgc"
BUILT_MODULE_NAME[7]="obdclass"
BUILT_MODULE_NAME[8]="obdecho"
BUILT_MODULE_NAME[9]="osc"
BUILT_MODULE_NAME[10]="ptlrpc"
BUILT_MODULE_NAME[11]="ko2iblnd"
BUILT_MODULE_NAME[12]="ksocklnd"
BUILT_MODULE_NAME[13]="libcfs"
BUILT_MODULE_NAME[14]="lnet"
BUILT_MODULE_NAME[15]="lnet_selftest"
@SERVER_TRUE@BUILT_MODULE_NAME[16]="lfsck"
@SERVER_TRUE@BUILT_MODULE_NAME[17]="lod"
@SERVER_TRUE@BUILT_MODULE_NAME[18]="lquota"
@SERVER_TRUE@BUILT_MODULE_NAME[19]="mdd"
@SERVER_TRUE@BUILT_MODULE_NAME[20]="mdt"
@SERVER_TRUE@BUILT_MODULE_NAME[21]="mgs"
@SERVER_TRUE@BUILT_MODULE_NAME[22]="ofd"
@SERVER_TRUE@BUILT_MODULE_NAME[23]="osp"
@SERVER_TRUE@BUILT_MODULE_NAME[24]="ost"

# Location of the modules in the source tree after build
BUILT_MODULE_LOCATION[0]="lustre/fid"
BUILT_MODULE_LOCATION[1]="lustre/fld"
BUILT_MODULE_LOCATION[2]="lustre/lmv"
BUILT_MODULE_LOCATION[3]="lustre/lov"
BUILT_MODULE_LOCATION[4]="lustre/llite"
BUILT_MODULE_LOCATION[5]="lustre/mdc"
BUILT_MODULE_LOCATION[6]="lustre/mgc"
BUILT_MODULE_LOCATION[7]="lustre/obdclass"
BUILT_MODULE_LOCATION[8]="lustre/obdecho"
BUILT_MODULE_LOCATION[9]="lustre/osc"
BUILT_MODULE_LOCATION[10]="lustre/ptlrpc"
BUILT_MODULE_LOCATION[11]="lnet/klnds/o2iblnd"
BUILT_MODULE_LOCATION[12]="lnet/klnds/socklnd"
BUILT_MODULE_LOCATION[13]="libcfs/libcfs"
BUILT_MODULE_LOCATION[14]="lnet/lnet"
BUILT_MODULE_LOCATION[15]="lnet/selftest"
@SERVER_TRUE@BUILT_MODULE_LOCATION[16]="lustre/lfsck"
@SERVER_TRUE@BUILT_MODULE_LOCATION[17]="lustre/lod"
@SERVER_TRUE@BUILT_MODULE_LOCATION[18]="lustre/quota"
@SERVER_TRUE@BUILT_MODULE_LOCATION[19]="lustre/mdd"
@SERVER_TRUE@BUILT_MODULE_LOCATION[20]="lustre/mdt"
@SERVER_TRUE@BUILT_MODULE_LOCATION[21]="lustre/mgs"
@SERVER_TRUE@BUILT_MODULE_LOCATION[22]="lustre/ofd"
@SERVER_TRUE@BUILT_MODULE_LOCATION[23]="lustre/osp"
@SERVER_TRUE@BUILT_MODULE_LOCATION[24]="lustre/ost"

# Final destination of the  modules under  /lib/modules/<kernel>/
DEST_MODULE_LOCATION[0]="/updates/kernel/fs/lustre"
DEST_MODULE_LOCATION[1]="/updates/kernel/fs/lustre"
DEST_MODULE_LOCATION[2]="/updates/kernel/fs/lustre"
DEST_MODULE_LOCATION[3]="/updates/kernel/fs/lustre"
DEST_MODULE_LOCATION[4]="/updates/kernel/fs/lustre"
DEST_MODULE_LOCATION[5]="/updates/kernel/fs/lustre"
DEST_MODULE_LOCATION[6]="/updates/kernel/fs/lustre"
DEST_MODULE_LOCATION[7]="/updates/kernel/fs/lustre"
DEST_MODULE_LOCATION[8]="/updates/kernel/fs/lustre"
DEST_MODULE_LOCATION[9]="/updates/kernel/fs/lustre"
DEST_MODULE_LOCATION[10]="/updates/kernel/fs/lustre"
DEST_MODULE_LOCATION[11]="/updates/kernel/net/lustre"
DEST_MODULE_LOCATION[12]="/updates/kernel/net/lustre"
DEST_MODULE_LOCATION[13]="/updates/kernel/net/lustre"
DEST_MODULE_LOCATION[14]="/updates/kernel/net/lustre"
DEST_MODULE_LOCATION[15]="/updates/kernel/net/lustre"
@SERVER_TRUE@DEST_MODULE_LOCATION[16]="/updates/kernel/fs/lustre"
@SERVER_TRUE@DEST_MODULE_LOCATION[17]="/updates/kernel/fs/lustre"
@SERVER_TRUE@DEST_MODULE_LOCATION[18]="/updates/kernel/fs/lustre"
@SERVER_TRUE@DEST_MODULE_LOCATION[19]="/updates/kernel/fs/lustre"
@SERVER_TRUE@DEST_MODULE_LOCATION[20]="/updates/kernel/fs/lustre"
@SERVER_TRUE@DEST_MODULE_LOCATION[21]="/updates/kernel/fs/lustre"
@SERVER_TRUE@DEST_MODULE_LOCATION[22]="/updates/kernel/fs/lustre"
@SERVER_TRUE@DEST_MODULE_LOCATION[23]="/updates/kernel/fs/lustre"
@SERVER_TRUE@DEST_MODULE_LOCATION[24]="/updates/kernel/fs/lustre"
