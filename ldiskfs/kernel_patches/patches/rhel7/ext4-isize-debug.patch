
Index: linux-3.10.0-123.13.2.el7.x86_64/fs/ext4/inode.c
===================================================================
--- linux-3.10.0-123.13.2.el7.x86_64.orig/fs/ext4/inode.c
+++ linux-3.10.0-123.13.2.el7.x86_64/fs/ext4/inode.c
@@ -5720,6 +5720,13 @@ static int ldiskfs_do_update_inode(handle_t *handle,
 			cpu_to_le16(ei->i_file_acl >> 32);
 	raw_inode->i_file_acl_lo = cpu_to_le32(ei->i_file_acl);
 	if (ei->i_disksize != ext4_isize(inode->i_sb, raw_inode)) {
+		if (S_ISDIR(inode->i_mode) && inode->i_nlink > 0 &&
+		    ei->i_disksize == 0) {
+			printk("inode %lu, nlink %u\n",
+				(unsigned long)inode->i_ino,
+				(unsigned)inode->i_nlink);
+			BUG();
+		}
 		ext4_isize_set(raw_inode, ei->i_disksize);
 		need_datasync = 1;
 	}
